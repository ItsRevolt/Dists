"use strict";const Discord=require("discord.js");let low=require("lowdb"),FileSync=require("lowdb/adapters/FileSync"),adapter=new FileSync("./db.json"),chalk=require("chalk"),log=console.log,success=chalk.bold.green,error=chalk.bold.bgRed,important=chalk.bold.bgYellow,db=low(adapter),owner=db.get("ownerID").value(),token=db.get("token").value(),prefix=db.get("prefix").value(),client=new Discord.Client;client.commands=new Discord.Collection;let login=()=>{client.login(token),client.on("ready",()=>{console.log(`\n        ${success("Bot Started Successfully")}. Logged in as ${success(client.user.tag)}!\n        `)})};function setActivity(e,t,n){e.client.user.setActivity(t,{type:n}).then(e=>console.log(`Activity set to ${e.game?e.game.name:"none"}`)).catch(console.error)}var ping={name:"ping",description:"Ping!",execute(e,t){e.channel.send("Pong.")}},echo={name:"echo",description:"Get message content and sends it back",permission:"default",aliases:["parrot"],execute(e,t){e.channel.send(e.content)}},YouTube=require("youtube-node"),SpotifyWebApi=require("spotify-web-api-node"),ytdl=require("ytdl-core"),youTube=new YouTube;youTube.setKey(db.get("youtube.key").value());var spotifyApi=new SpotifyWebApi({clientId:db.get("spotify.clientID").value(),clientSecret:db.get("spotify.clientSecret").value()}),queue=[];let resetQueue=()=>{queue=[]};async function grantSpotifyCredentials(){try{let e=await spotifyApi.clientCredentialsGrant();console.log("The access token expires in "+e.body.expires_in),console.log("The access token is "+e.body.access_token),spotifyApi.setAccessToken(e.body.access_token)}catch(e){console.log("Something went wrong when retrieving an access token",e)}}grantSpotifyCredentials();var play={name:"play",description:"Plays audio from several sources!",args:!0,aliases:["song"],usage:"<yt url> or <yt search query> or <spotify> <userID> <playlistID> <limit>(optional)",execute(e,t,n){let i=t[0],o=t.join().replace(","," ");async function r(){let t,i=n.voiceConnections.find(t=>t.channel.guild.id==e.guild.id);if(!(Array.isArray(queue)&&queue.length||null===i))return i.disconnect(),setActivity(e,"Nothing","LISTENING"),e.channel.send("```Done playing Song(s)```");t=null===i?await e.member.voiceChannel.join():await i;let o=queue[0],s=ytdl(o,{filter:"audioonly"}),a=t.playStream(s);ytdl.getInfo(o,(t,n)=>{t&&console.log("Error trying to get info before setting activity."+t),setActivity(e,n.title,"LISTENING")}),a.on("end",()=>{setTimeout(()=>{queue.length>0?(queue.shift(),r()):setActivity(e,"Nothing","LISTENING")},500)})}function s(t){youTube.search(t,1,function(t,n){if(t)console.log("Error searching. -yt"+t),e.reply("Error Searching. -yt");else{let t=n.items[0].id.videoId;ytdl.getInfo(t,(t,n)=>{t&&(console.log("Error getting info. -ytdl"+t),e.reply("Error getting info. -ytdl")),queue.push(n.video_url),1===queue.length&&r()})}})}!function(){if(!e.guild)return;if(!e.member.voiceChannel)return e.reply("```You are not in a channel! :thermometer_face:```");i.indexOf("youtu.be")>-1||i.indexOf("youtube.com")>-1?(queue.push(i),1===queue.length&&r(),queue.length>=1&&ytdl.getInfo(i).then(t=>{e.reply(`**[${queue.length}]**-${t.title}`)})):"spotify"==i.toLowerCase()?async function n(){let i=t[1];let o=t[2];let r=t[3];if(!db.has("spotify.clientID").value()||!db.has("spotify.clientSecret").value())return e.reply("It appears that the server owner has not configured Spotify. Please bug that person.");if(25!==i.length)return e.reply("Invalid user ID!");if(22!==o.length)return e.reply("Invalid playlist ID!");switch(!0){case r>100:return e.reply("Limit cannot be greater than 100");case"all"==r:r=100;break;case r:r=r;break;default:r=30}try{let t=await spotifyApi.getPlaylistTracks(i,o,{offset:1,limit:r,fields:"items(track(name,artists))"});for(let e in t.body.items){let n=t.body.items[e].track.name,i=t.body.items[e].track.artists[0].name;s(`${n} - ${i} audio`)}}catch(t){console.log("Error getting spotify playlist"+t),await grantSpotifyCredentials(),await e.reply("Error getting spotify playlist. Trying again."),await n()}}():s(o)}()}};const fs=require("fs"),ytdl$1=require("ytdl-core");var queue$1={name:"queue",description:"Shows audio queue",async execute(e,t,n){if(0==queue.length)return e.channel.send("Nothing in queue bud");var i;i=queue.length<30?await e.reply("Getting queue. This may take a while :cow:"):await e.reply("Queue is big. Sending in DM. :cow:"),async function(){let t=[];for(var n=0,o=queue.length;n<o;n++){let i=await ytdl$1.getInfo(queue[n]);if(t.push("\n**["+n+"]** - "+i.title),10==t.length){var r=t.join("");queue.length<30?e.channel.send(r):e.author.sendMessage(r),t=[]}}await i.delete(),await console.log(t)}()}};const fs$1=require("fs"),ytdl$2=require("ytdl-core");var skip={name:"skip",description:"Skips to next song in queue",execute(e,t,n){if(0===queue.length)return e.reply("You cannot skip a non-existent song! :raised_hands::skin-tone-5:");var i=Math.min(1,queue.length);queue.splice(0,i-1);var o=n.voiceConnections.find(t=>t.channel.guild.id==e.guild.id);const r=o.player.dispatcher;o.paused&&r.resume(),r.end(),e.reply("**Skipped!** :ok_hand::skin-tone-5:")}};const fs$2=require("fs"),ytdl$3=require("ytdl-core");var stop={name:"stop",description:"Stops all audio playing, removes all in queue, and doesnt continue queue",execute(e,t,n){resetQueue();var i=n.voiceConnections.find(t=>t.channel.guild.id==e.guild.id);if(!i)return;const o=i.player.dispatcher;i.paused&&o.resume(),o.end(),i.disconnect(),e.reply("**Stopped!** :ok_hand::skin-tone-5: ")}},fuck={name:"fuck",description:"Sends a fuck you to the person of choice",args:!0,usage:"<thing>",execute(e,t){var n=t[0];Math.random()>.35?e.channel.send(`Yeah, fuck **${n}**`):e.reply("No, fuck you")}};let Files=[ping,echo,play,skip,queue$1,stop,fuck];function create(){for(const e of Files)console.log(success("Loaded: ")+e.name),client.commands.set(e.name,e);client.on("message",e=>{if(console.info(`${important(e.author.username)} Posted: '${success(e.content)}' - ${error(e.createdTimestamp)}`),!e.content.startsWith(prefix)||e.author.bot)return;const t=e.content.slice(prefix.length).split(/ +/),n=t.shift().toLowerCase(),i=client.commands.get(n)||client.commands.find(e=>e.aliases&&e.aliases.includes(n));if(i){if(i.guildOnly&&"text"!==e.channel.type)return e.reply("I can't execute that command inside DMs!");if(i.args&&!t.length){let t=`You didn't provide any arguments, ${e.author}!`;return i.usage&&(t+=`\nThe proper usage would be: \`${prefix}${i.name} ${i.usage}\``),e.channel.send(t)}try{i.execute(e,t,client)}catch(t){console.error(t),e.reply("There was an error trying to execute that command!")}}}),login()}var inquirer=require("inquirer");const consola=require("consola");let questions=[{type:"input",name:"ownerID",message:"What's your discord user id? (https://support.discordapp.com/hc/en-us/articles/206346498-Where-can-I-find-my-User-Server-Message-ID-)",validate:function(e){return null!==e||"string"!==e||"Please enter a valid user id"}},{type:"input",name:"token",message:"What's your bots token?",validate:function(e){return null!==e||"string"!==e||"Please enter a valid token"}},{type:"input",name:"prefix",message:"What's prefix to get bots attention?",default:"!",validate:function(e){return null!==e||"string"!==e?e.length<=5||"Prefix must not be longer than 5 characters":"Please enter a valid prefix"}},{type:"input",name:"admingroup",message:"What is the admin group called on your server?",default:"Admin",validate:function(e){return null!==e||"string"!==e||"Please enter a valid admin group"}},{type:"input",name:"moderatorgroup",message:"What is the moderator group called on your server?",default:"Moderator",validate:function(e){return null!==e||"string"!==e||"Please enter a valid moderator group"}},{type:"input",name:"clientID",message:"What is your spotify client id? | Optional",default:""},{type:"input",name:"clientSecret",message:"What is your spotify client secret? | Optional",default:""},{type:"input",name:"youtubeKey",message:"What is your youtube api key? (Used to search. Lining youtube urls still works | Optional)",default:""}];function cli(){inquirer.prompt(questions).then(e=>{db.set("ownerID",e.ownerID),db.set("token",e.token),db.set("firstrun",!1),db.set("prefix",e.prefix),db.set("admingroup",e.admingroup),db.set("moderatorgroup",e.moderatorgroup),db.set("spotify.clientID",e.clientID),db.set("spotify.clientSecret",e.clientSecret),db.set("spotify.clientSecret",e.clientSecret),db.set("youtube.key",e.youtubeKey).write(),consola.success(`Your bot has been created with token: ${e.token}`),consola.info('To start your bot, type "node dists.js"'),consola.info("To add the bot to your guild, follow this link (REPLACE CLIENT_ID_HERE WITH THE ONE FROM YOUR BOT):https://discordapp.com/api/oauth2/authorize?client_id=CLIENT_ID_HERE&permissions=8&scope=bot")})}db.defaults({commandAliases:[],admingroup:"",moderatorgroup:"",permissions:[],firstrun:!0,prefix:"",spotify:{clientID:"",clientSecret:""}}).write();let firstrun=db.get("firstrun").value();1==firstrun?cli():create();
